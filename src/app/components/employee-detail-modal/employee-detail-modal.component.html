<div class="employee-detail-modal">
  <div class="modal-header">
    <div class="employee-header">
      <div class="employee-avatar">
        <mat-icon class="avatar-icon">person</mat-icon>
      </div>
      <div class="employee-info">
        <h1 class="employee-name">{{employee.name}}</h1>
        <div class="employee-meta">
          <span class="job-title">
            <mat-icon>work</mat-icon>
            {{employee.currentRole}}
          </span>
          <span class="department">
            <mat-icon>business</mat-icon>
            {{employee.department}}
          </span>
          <span class="experience">
            <mat-icon>schedule</mat-icon>
            {{employee.yearsExperience}} years experience
          </span>
        </div>
      </div>
    </div>
    
    <div class="header-actions">
      <button *ngIf="!isEditMode" mat-fab color="primary" (click)="toggleEditMode()" matTooltip="Edit Profile">
        <mat-icon>edit</mat-icon>
      </button>
      
      <div *ngIf="isEditMode" class="edit-actions">
        <button mat-fab color="primary" (click)="saveChanges()" matTooltip="Save Changes">
          <mat-icon>save</mat-icon>
        </button>
        <button mat-fab color="warn" (click)="cancelEdit()" matTooltip="Cancel">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      
      <button mat-icon-button (click)="onClose()" matTooltip="Close">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <div class="modal-content">
    <!-- Performance Summary Cards -->
    <div class="summary-cards">
      <mat-card class="summary-card performance-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>trending_up</mat-icon>
          <mat-card-title>Performance</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="metric">
            <mat-form-field *ngIf="isEditMode" appearance="outline" class="summary-field">
              <mat-select [(ngModel)]="editableEmployee.performanceRating">
                <mat-option value="Outstanding">Outstanding</mat-option>
                <mat-option value="Exceeds">Exceeds</mat-option>
                <mat-option value="Meets">Meets</mat-option>
                <mat-option value="Below">Below</mat-option>
              </mat-select>
            </mat-form-field>
            <span *ngIf="!isEditMode" class="metric-value">{{employee.performanceRating}}</span>
            <span class="metric-label">Current Rating</span>
          </div>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="summary-card retention-card">
        <mat-card-header>
          <mat-icon mat-card-avatar [class]="getAttritionRiskClass(employee.attritionRisk)">warning</mat-icon>
          <mat-card-title>Retention Risk</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="metric">
            <mat-form-field *ngIf="isEditMode" appearance="outline" class="summary-field">
              <mat-select [(ngModel)]="editableEmployee.retentionRisk">
                <mat-option value="Low">Low</mat-option>
                <mat-option value="Medium">Medium</mat-option>
                <mat-option value="High">High</mat-option>
              </mat-select>
            </mat-form-field>
            <span *ngIf="!isEditMode" class="metric-value" [class]="getAttritionRiskClass(employee.attritionRisk)">{{employee.retentionRisk}}</span>
            <span class="metric-label">Risk Level</span>
          </div>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="summary-card tdi-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>psychology</mat-icon>
          <mat-card-title>TDI Zone</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="metric">
            <mat-form-field *ngIf="isEditMode" appearance="outline" class="summary-field">
              <mat-select [(ngModel)]="editableEmployee.tdiZone">
                <mat-option value="Invest Now">Invest Now</mat-option>
                <mat-option value="Develop">Develop</mat-option>
                <mat-option value="Maintain">Maintain</mat-option>
              </mat-select>
            </mat-form-field>
            <span *ngIf="!isEditMode" class="metric-value">{{employee.tdiZone}}</span>
            <span class="metric-label">Development Zone</span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Tabbed Content -->
    <mat-tab-group class="detail-tabs">
      <mat-tab label="Profile & Performance">
        <div class="tab-content">
          <div class="cards-grid">
            <!-- TDI Profile Card -->
            <mat-card class="info-card">
              <mat-card-header>
                <mat-icon mat-card-avatar>badge</mat-icon>
                <mat-card-title>TDI Profile</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="info-grid">
                  <div class="info-item">
                    <mat-icon class="info-icon">schedule</mat-icon>
                    <div class="info-content">
                      <span class="info-label">Time in Role</span>
                      <mat-form-field *ngIf="isEditMode" appearance="outline" class="modern-field">
                        <mat-label>Time in Role</mat-label>
                        <input matInput [(ngModel)]="editableEmployee.timeInRole" placeholder="e.g., 2 years 5 months">
                      </mat-form-field>
                      <span *ngIf="!isEditMode" class="info-value">{{employee.timeInRole || 'Not set'}}</span>
                    </div>
                  </div>
                  
                  <div class="info-item">
                    <mat-icon class="info-icon">work_history</mat-icon>
                    <div class="info-content">
                      <span class="info-label">Length of Service</span>
                      <mat-form-field *ngIf="isEditMode" appearance="outline" class="modern-field">
                        <mat-label>Length of Service</mat-label>
                        <input matInput [(ngModel)]="editableEmployee.lengthOfService" placeholder="e.g., 5 years 2 months">
                      </mat-form-field>
                      <span *ngIf="!isEditMode" class="info-value">{{employee.lengthOfService || 'Not set'}}</span>
                    </div>
                  </div>
                  
                  <div class="info-item">
                    <mat-icon class="info-icon">trending_up</mat-icon>
                    <div class="info-content">
                      <span class="info-label">Promotion Forecast</span>
                      <mat-form-field *ngIf="isEditMode" appearance="outline" class="modern-field">
                        <mat-label>Promotion Forecast</mat-label>
                        <input matInput [(ngModel)]="editableEmployee.promotionForecast" placeholder="e.g., YE 2026">
                      </mat-form-field>
                      <span *ngIf="!isEditMode" class="info-value">{{employee.promotionForecast || 'Not set'}}</span>
                    </div>
                  </div>
                  
                  <div class="info-item">
                    <mat-icon class="info-icon">event</mat-icon>
                    <div class="info-content">
                      <span class="info-label">Last Promo Date</span>
                      <mat-form-field *ngIf="isEditMode" appearance="outline" class="modern-field">
                        <mat-label>Last Promo Date</mat-label>
                        <input matInput [(ngModel)]="editableEmployee.lastPromoDate" type="date">
                      </mat-form-field>
                      <span *ngIf="!isEditMode" class="info-value">{{formatDate(employee.lastPromoDate)}}</span>
                    </div>
                  </div>
                  
                </div>
              </mat-card-content>
            </mat-card>

            <!-- Development Focus Card -->
            <mat-card class="info-card">
              <mat-card-header>
                <mat-icon mat-card-avatar>trending_up</mat-icon>
                <mat-card-title>Development Focus</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="development-chips">
                  <div class="chip-row">
                    <span class="chip-label">Preparing for Promo:</span>
                    <mat-slide-toggle *ngIf="isEditMode" [(ngModel)]="editableEmployee.preparingForPromo" class="modern-toggle">
                      {{editableEmployee.preparingForPromo ? 'Yes' : 'No'}}
                    </mat-slide-toggle>
                    <mat-chip-set *ngIf="!isEditMode">
                      <mat-chip [highlighted]="employee.preparingForPromo">
                        {{employee.preparingForPromo ? 'Yes' : 'No'}}
                      </mat-chip>
                    </mat-chip-set>
                  </div>
                  
                  <div class="chip-row">
                    <span class="chip-label">Preparing for Stretch:</span>
                    <mat-slide-toggle *ngIf="isEditMode" [(ngModel)]="editableEmployee.preparingForStretch" class="modern-toggle">
                      {{editableEmployee.preparingForStretch ? 'Yes' : 'No'}}
                    </mat-slide-toggle>
                    <mat-chip-set *ngIf="!isEditMode">
                      <mat-chip [highlighted]="employee.preparingForStretch">
                        {{employee.preparingForStretch ? 'Yes' : 'No'}}
                      </mat-chip>
                    </mat-chip-set>
                  </div>
                  
                  <div class="chip-row">
                    <span class="chip-label">Preparing for Rotation:</span>
                    <mat-slide-toggle *ngIf="isEditMode" [(ngModel)]="editableEmployee.preparingForRotation" class="modern-toggle">
                      {{editableEmployee.preparingForRotation ? 'Yes' : 'No'}}
                    </mat-slide-toggle>
                    <mat-chip-set *ngIf="!isEditMode">
                      <mat-chip [highlighted]="employee.preparingForRotation">
                        {{employee.preparingForRotation ? 'Yes' : 'No'}}
                      </mat-chip>
                    </mat-chip-set>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
          
          <!-- Performance Ratings Section - Full Width -->
          <mat-card class="performance-ratings-section">
            <mat-card-header>
              <mat-icon mat-card-avatar>star</mat-icon>
              <mat-card-title>Performance Ratings</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="rating-cycles-grid">
                <div class="rating-cycle">
                  <span class="cycle-label">MY '24</span>
                  <mat-form-field *ngIf="isEditMode" appearance="outline" class="cycle-field">
                    <mat-select [(ngModel)]="editableEmployee.ratingCycles!.MY24">
                      <mat-option *ngFor="let rating of ratingCycleOptions" [value]="rating">
                        {{rating}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                  <span *ngIf="!isEditMode" class="cycle-value">{{employee.ratingCycles?.MY24 || employee.myRating || 'Not set'}}</span>
                </div>
                
                <div class="rating-cycle">
                  <span class="cycle-label">YE '24</span>
                  <mat-form-field *ngIf="isEditMode" appearance="outline" class="cycle-field">
                    <mat-select [(ngModel)]="editableEmployee.ratingCycles!.YE24">
                      <mat-option *ngFor="let rating of ratingCycleOptions" [value]="rating">
                        {{rating}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                  <span *ngIf="!isEditMode" class="cycle-value">{{employee.ratingCycles?.YE24 || employee.yeRating || 'Not set'}}</span>
                </div>
                
                <div class="rating-cycle">
                  <span class="cycle-label">MY '25</span>
                  <mat-form-field *ngIf="isEditMode" appearance="outline" class="cycle-field">
                    <mat-select [(ngModel)]="editableEmployee.ratingCycles!.MY25">
                      <mat-option *ngFor="let rating of ratingCycleOptions" [value]="rating">
                        {{rating}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                  <span *ngIf="!isEditMode" class="cycle-value">{{employee.ratingCycles?.MY25 || 'Not set'}}</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <mat-tab label="Skills & Interests">
        <div class="tab-content">
          <div class="cards-grid">
            <!-- Skills Card -->
            <mat-card class="info-card">
              <mat-card-header>
                <mat-icon mat-card-avatar>build</mat-icon>
                <mat-card-title>Skills</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <mat-chip-grid #skillChipGrid *ngIf="isEditMode" class="chip-container">
                  <mat-chip-row *ngFor="let skill of editableEmployee.skills; let i = index" 
                                (removed)="removeSkillChip(i)"
                                class="skill-chip">
                    {{skill}}
                    <button matChipRemove [attr.aria-label]="'remove ' + skill">
                      <mat-icon>cancel</mat-icon>
                    </button>
                  </mat-chip-row>
                  <input placeholder="Add skill..."
                         [matChipInputFor]="skillChipGrid"
                         [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                         [matChipInputAddOnBlur]="true"
                         (matChipInputTokenEnd)="addSkillChip($event)">
                </mat-chip-grid>
                <mat-chip-set *ngIf="!isEditMode" class="chip-container">
                  <mat-chip *ngFor="let skill of employee.skills" class="skill-chip">
                    {{skill}}
                  </mat-chip>
                </mat-chip-set>
              </mat-card-content>
            </mat-card>

            <!-- Interests Card -->
            <mat-card class="info-card">
              <mat-card-header>
                <mat-icon mat-card-avatar>interests</mat-icon>
                <mat-card-title>Interests</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <mat-chip-grid #interestChipGrid *ngIf="isEditMode" class="chip-container">
                  <mat-chip-row *ngFor="let interest of editableEmployee.interests; let i = index" 
                                (removed)="removeInterestChip(i)"
                                class="interest-chip">
                    {{interest}}
                    <button matChipRemove [attr.aria-label]="'remove ' + interest">
                      <mat-icon>cancel</mat-icon>
                    </button>
                  </mat-chip-row>
                  <input placeholder="Add interest..."
                         [matChipInputFor]="interestChipGrid"
                         [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                         [matChipInputAddOnBlur]="true"
                         (matChipInputTokenEnd)="addInterestChip($event)">
                </mat-chip-grid>
                <mat-chip-set *ngIf="!isEditMode" class="chip-container">
                  <mat-chip *ngFor="let interest of employee.interests" class="interest-chip">
                    {{interest}}
                  </mat-chip>
                </mat-chip-set>
              </mat-card-content>
            </mat-card>

            <!-- Career Goals Card -->
            <mat-card class="info-card">
              <mat-card-header>
                <mat-icon mat-card-avatar>flag</mat-icon>
                <mat-card-title>Career Goals</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <mat-chip-grid #careerGoalChipGrid *ngIf="isEditMode" class="chip-container">
                  <mat-chip-row *ngFor="let goal of editableEmployee.careerGoals; let i = index" 
                                (removed)="removeCareerGoalChip(i)"
                                class="goal-chip">
                    {{goal}}
                    <button matChipRemove [attr.aria-label]="'remove ' + goal">
                      <mat-icon>cancel</mat-icon>
                    </button>
                  </mat-chip-row>
                  <input placeholder="Add career goal..."
                         [matChipInputFor]="careerGoalChipGrid"
                         [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                         [matChipInputAddOnBlur]="true"
                         (matChipInputTokenEnd)="addCareerGoalChip($event)">
                </mat-chip-grid>
                <mat-chip-set *ngIf="!isEditMode" class="chip-container">
                  <mat-chip *ngFor="let goal of employee.careerGoals" class="goal-chip">
                    {{goal}}
                  </mat-chip>
                </mat-chip-set>
              </mat-card-content>
            </mat-card>

            <!-- Skillset Experience Card -->
            <mat-card class="info-card" *ngIf="employee.skillsetExperience && employee.skillsetExperience.length > 0">
              <mat-card-header>
                <mat-icon mat-card-avatar>engineering</mat-icon>
                <mat-card-title>Technical Experience</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <mat-chip-set class="chip-container">
                  <mat-chip *ngFor="let experience of employee.skillsetExperience" class="experience-chip">
                    {{experience}}
                  </mat-chip>
                </mat-chip-set>
              </mat-card-content>
            </mat-card>

            <!-- Career Interests Card -->
            <mat-card class="info-card" *ngIf="employee.careerInterest && employee.careerInterest.length > 0">
              <mat-card-header>
                <mat-icon mat-card-avatar>explore</mat-icon>
                <mat-card-title>Career Interests</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <mat-chip-set class="chip-container">
                  <mat-chip *ngFor="let interest of employee.careerInterest" class="career-interest-chip">
                    {{interest}}
                  </mat-chip>
                </mat-chip-set>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="Development & Plans">
        <div class="tab-content">
          <div class="cards-grid single-column">
            <!-- Development Needs Card -->
            <mat-card class="info-card">
              <mat-card-header>
                <mat-icon mat-card-avatar>school</mat-icon>
                <mat-card-title>Development Needs</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="development-section">
                  <div class="development-item">
                    <h4>Current Gaps & Opportunities</h4>
                    <mat-form-field *ngIf="isEditMode" appearance="outline" class="full-width">
                      <mat-label>Current gaps and opportunities</mat-label>
                      <textarea matInput [(ngModel)]="editableEmployee.currentGapsOpportunities" rows="3"></textarea>
                    </mat-form-field>
                    <p *ngIf="!isEditMode" class="development-text">{{employee.currentGapsOpportunities || 'Not set'}}</p>
                  </div>

                  <div class="development-item">
                    <h4>What needs to be demonstrated to unlock next level performance?</h4>
                    <mat-form-field *ngIf="isEditMode" appearance="outline" class="full-width">
                      <mat-label>Development needs</mat-label>
                      <textarea matInput [(ngModel)]="editableEmployee.whatNeedsToBeDemonstrated" rows="3"></textarea>
                    </mat-form-field>
                    <p *ngIf="!isEditMode" class="development-text">{{employee.whatNeedsToBeDemonstrated || 'Not set'}}</p>
                  </div>
                  
                  <div class="development-item">
                    <h4>How do we need to differentially invest to unlock next step change?</h4>
                    <mat-form-field *ngIf="isEditMode" appearance="outline" class="full-width">
                      <mat-label>Investment strategy</mat-label>
                      <textarea matInput [(ngModel)]="editableEmployee.howToInvest" rows="3"></textarea>
                    </mat-form-field>
                    <p *ngIf="!isEditMode" class="development-text">{{employee.howToInvest || 'Not set'}}</p>
                  </div>
                  
                  <div class="development-item">
                    <h4>What support can the group provide?</h4>
                    <mat-form-field *ngIf="isEditMode" appearance="outline" class="full-width">
                      <mat-label>Group support</mat-label>
                      <textarea matInput [(ngModel)]="editableEmployee.whatSupportNeeded" rows="3"></textarea>
                    </mat-form-field>
                    <p *ngIf="!isEditMode" class="development-text">{{employee.whatSupportNeeded || 'Not set'}}</p>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>

            <!-- Retention & Plans Card -->
            <mat-card class="info-card">
              <mat-card-header>
                <mat-icon mat-card-avatar>assignment</mat-icon>
                <mat-card-title>Retention & Plans</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="retention-section">
                  <div class="retention-item">
                    <div class="retention-row">
                      <span class="retention-label">Retention Plan Needed:</span>
                      <mat-slide-toggle *ngIf="isEditMode" [(ngModel)]="editableEmployee.retentionPlanNeeded" class="modern-toggle">
                        {{editableEmployee.retentionPlanNeeded ? 'Yes' : 'No'}}
                      </mat-slide-toggle>
                      <mat-chip-set *ngIf="!isEditMode">
                        <mat-chip [highlighted]="employee.retentionPlanNeeded">
                          {{employee.retentionPlanNeeded ? 'Yes' : 'No'}}
                        </mat-chip>
                      </mat-chip-set>
                    </div>
                    <mat-form-field *ngIf="isEditMode" appearance="outline" class="full-width">
                      <mat-label>Justification</mat-label>
                      <input matInput [(ngModel)]="editableEmployee.retentionPlanJustification">
                    </mat-form-field>
                    <p *ngIf="!isEditMode" class="justification-text">{{employee.retentionPlanJustification || 'Not set'}}</p>
                  </div>
                  
                  <div class="retention-item">
                    <div class="retention-row">
                      <span class="retention-label">Rotation / Stretch Plan Needed:</span>
                      <mat-slide-toggle *ngIf="isEditMode" [(ngModel)]="editableEmployee.rotationStechPlanNeeded" class="modern-toggle">
                        {{editableEmployee.rotationStechPlanNeeded ? 'Yes' : 'No'}}
                      </mat-slide-toggle>
                      <mat-chip-set *ngIf="!isEditMode">
                        <mat-chip [highlighted]="employee.rotationStechPlanNeeded">
                          {{employee.rotationStechPlanNeeded ? 'Yes' : 'No'}}
                        </mat-chip>
                      </mat-chip-set>
                    </div>
                    <mat-form-field *ngIf="isEditMode" appearance="outline" class="full-width">
                      <mat-label>Justification</mat-label>
                      <input matInput [(ngModel)]="editableEmployee.rotationStechPlanJustification">
                    </mat-form-field>
                    <p *ngIf="!isEditMode" class="justification-text">{{employee.rotationStechPlanJustification || 'Not set'}}</p>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
