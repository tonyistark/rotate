<div class="modal-header" [class.edit-mode]="isEditMode">
  <div class="header-content">
    <div class="title-section">
      <h2 mat-dialog-title *ngIf="!isEditMode">{{match.opportunity.title}}</h2>
      <mat-form-field *ngIf="isEditMode" appearance="outline" class="title-field">
        <mat-label>Title</mat-label>
        <input matInput [(ngModel)]="editableOpportunity.title" placeholder="Opportunity title">
      </mat-form-field>
      <div class="subtitle-info" *ngIf="!isEditMode">
        <span class="department">
          <mat-icon>business</mat-icon>
          {{match.opportunity.department}}
        </span>
        <span class="duration">
          <mat-icon>schedule</mat-icon>
          {{match.opportunity.duration}}
        </span>
      </div>
      <div class="subtitle-info-edit" *ngIf="isEditMode">
        <mat-form-field appearance="outline" class="subtitle-field">
          <mat-label>Department</mat-label>
          <mat-select [(ngModel)]="editableOpportunity.department">
            <mat-option *ngFor="let dept of departments" [value]="dept">
              {{dept}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="subtitle-field">
          <mat-label>Job Family</mat-label>
          <mat-select [(ngModel)]="editableOpportunity.jobFamily">
            <mat-option *ngFor="let family of jobFamilies" [value]="family">
              {{family}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="subtitle-field">
          <mat-label>Job Level</mat-label>
          <mat-select [(ngModel)]="editableOpportunity.jobLevel">
            <mat-option *ngFor="let level of jobLevels" [value]="level">
              {{level}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div class="header-meta">
      <div class="submitted-by" *ngIf="!isEditMode">
        <mat-icon>person</mat-icon>
        <span>Submitted by {{match.opportunity.submittedBy}}</span>
      </div>
      <mat-form-field *ngIf="isEditMode" appearance="outline" class="submitted-by-field">
        <mat-label>Submitted By</mat-label>
        <input matInput [(ngModel)]="editableOpportunity.submittedBy" placeholder="Name of submitter">
      </mat-form-field>
    </div>
  </div>
  <div class="header-actions">
    <button *ngIf="!isEditMode" mat-fab color="primary" (click)="toggleEditMode()" matTooltip="Edit Profile">
      <mat-icon>edit</mat-icon>
    </button>
    
    <div *ngIf="isEditMode" class="edit-actions">
      <button mat-fab color="primary" (click)="saveChanges()" matTooltip="Save Changes">
        <mat-icon>save</mat-icon>
      </button>
      <button mat-fab color="warn" (click)="exitEditMode()" matTooltip="Cancel">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <button mat-icon-button (click)="onClose()" matTooltip="Close">
      <mat-icon>close</mat-icon>
    </button>
  </div>
</div>


<mat-dialog-content class="modal-content">
  <div class="description-section full-width">
    <h3><mat-icon>description</mat-icon> Description</h3>
    <p class="description" *ngIf="!isEditMode">{{match.opportunity.description}}</p>
    <mat-form-field *ngIf="isEditMode" appearance="outline" class="description-field">
      <textarea matInput [(ngModel)]="editableOpportunity.description" rows="5" placeholder="Provide a detailed description of the opportunity, including key responsibilities and expectations"></textarea>
    </mat-form-field>
  </div>

  <div class="skills-section">
    <div class="skill-group">
      <h3><mat-icon>check_circle</mat-icon> Required Skills</h3>
      <div class="chip-container" *ngIf="!isEditMode">
        <mat-chip *ngFor="let skill of match.opportunity.requiredSkills" color="warn" selected>
          {{skill}}
        </mat-chip>
      </div>
      <mat-chip-grid #requiredSkillsGrid *ngIf="isEditMode" class="chip-container">
        <mat-chip-row *ngFor="let skill of editableOpportunity.requiredSkills; let i = index" 
                      (removed)="removeRequiredSkill(i)"
                      color="warn" selected>
          {{skill}}
          <button matChipRemove [attr.aria-label]="'remove ' + skill">
            <mat-icon>cancel</mat-icon>
          </button>
        </mat-chip-row>
        <input placeholder="Add required skill..."
               [matChipInputFor]="requiredSkillsGrid"
               [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
               [matChipInputAddOnBlur]="true"
               (matChipInputTokenEnd)="addRequiredSkill($event)">
      </mat-chip-grid>
    </div>

    <div class="skill-group">
      <h3><mat-icon>star</mat-icon> Preferred Skills</h3>
      <div class="chip-container" *ngIf="!isEditMode">
        <mat-chip *ngFor="let skill of match.opportunity.preferredSkills" color="primary" selected>
          {{skill}}
        </mat-chip>
      </div>
      <mat-chip-grid #preferredSkillsGrid *ngIf="isEditMode" class="chip-container">
        <mat-chip-row *ngFor="let skill of editableOpportunity.preferredSkills; let i = index" 
                      (removed)="removePreferredSkill(i)"
                      color="primary" selected>
          {{skill}}
          <button matChipRemove [attr.aria-label]="'remove ' + skill">
            <mat-icon>cancel</mat-icon>
          </button>
        </mat-chip-row>
        <input placeholder="Add preferred skill..."
               [matChipInputFor]="preferredSkillsGrid"
               [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
               [matChipInputAddOnBlur]="true"
               (matChipInputTokenEnd)="addPreferredSkill($event)">
      </mat-chip-grid>
    </div>
  </div>

  <div class="learning-outcomes">
    <h3><mat-icon>school</mat-icon> Learning Outcomes</h3>
    <div class="chip-container" *ngIf="!isEditMode">
      <mat-chip *ngFor="let outcome of match.opportunity.learningOutcomes" color="accent" selected>
        {{outcome}}
      </mat-chip>
    </div>
    <mat-chip-grid #learningOutcomesGrid *ngIf="isEditMode" class="chip-container">
      <mat-chip-row *ngFor="let outcome of editableOpportunity.learningOutcomes; let i = index" 
                    (removed)="removeLearningOutcome(i)"
                    color="accent" selected>
        {{outcome}}
        <button matChipRemove [attr.aria-label]="'remove ' + outcome">
          <mat-icon>cancel</mat-icon>
        </button>
      </mat-chip-row>
      <input placeholder="Add learning outcome..."
             [matChipInputFor]="learningOutcomesGrid"
             [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
             [matChipInputAddOnBlur]="true"
             (matChipInputTokenEnd)="addLearningOutcome($event)">
    </mat-chip-grid>
  </div>

  <div class="performance-ratings-section" *ngIf="match.opportunity.previousPerformanceRatings && match.opportunity.previousPerformanceRatings.length > 0 || isEditMode">
    <h3><mat-icon>assessment</mat-icon> Required Previous Performance Ratings</h3>
    <div class="chip-container" *ngIf="!isEditMode">
      <mat-chip *ngFor="let rating of match.opportunity.previousPerformanceRatings" color="primary" selected>
        {{rating}}
      </mat-chip>
    </div>
    <mat-chip-grid #performanceRatingsGrid *ngIf="isEditMode" class="chip-container">
      <mat-chip-row *ngFor="let rating of editableOpportunity.previousPerformanceRatings; let i = index" 
                    (removed)="removePerformanceRating(i)"
                    color="primary" selected>
        {{rating}}
        <button matChipRemove [attr.aria-label]="'remove ' + rating">
          <mat-icon>cancel</mat-icon>
        </button>
      </mat-chip-row>
      <input placeholder="Add performance rating requirement..."
             [matChipInputFor]="performanceRatingsGrid"
             [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
             [matChipInputAddOnBlur]="true"
             (matChipInputTokenEnd)="addPerformanceRating($event)">
    </mat-chip-grid>
  </div>

  <div class="opportunity-details" *ngIf="!isEditMode">
    <div class="detail-item">
      <mat-icon>access_time</mat-icon>
      <span>{{match.opportunity.timeCommitment}}</span>
    </div>
    <div class="detail-item">
      <mat-icon>{{match.opportunity.mentorAvailable ? 'supervisor_account' : 'person'}}</mat-icon>
      <span>{{match.opportunity.mentorAvailable ? 'Mentor Available' : 'Self-Directed'}}</span>
    </div>
    <div class="detail-item">
      <mat-icon>{{match.opportunity.remote ? 'home' : 'location_city'}}</mat-icon>
      <span>{{match.opportunity.remote ? 'Remote OK' : 'On-site'}}</span>
    </div>
  </div>
  
  <div class="opportunity-details-edit" *ngIf="isEditMode">
    <div class="details-grid">
      <mat-form-field appearance="outline" class="detail-field">
        <mat-label>Time Commitment</mat-label>
        <input matInput [(ngModel)]="editableOpportunity.timeCommitment" placeholder="e.g., 10 hours/week">
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="detail-field">
        <mat-label>Duration</mat-label>
        <input matInput [(ngModel)]="editableOpportunity.duration" placeholder="e.g., 6 months">
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="detail-field">
        <mat-label>Rotation Length</mat-label>
        <mat-select [(ngModel)]="editableOpportunity.rotationLength">
          <mat-option *ngFor="let length of rotationLengths" [value]="length">
            {{length}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="detail-field">
        <mat-label>Leader</mat-label>
        <mat-select [(ngModel)]="editableOpportunity.leader">
          <mat-option *ngFor="let leader of leaders" [value]="leader">
            {{leader}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="detail-field">
        <mat-label>Job Profile</mat-label>
        <mat-select [(ngModel)]="editableOpportunity.jobProfile">
          <mat-option *ngFor="let profile of jobProfiles" [value]="profile">
            {{profile}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="detail-field">
        <mat-label>PL/IC</mat-label>
        <mat-select [(ngModel)]="editableOpportunity.plIc">
          <mat-option value="PL">PL</mat-option>
          <mat-option value="IC">IC</mat-option>
        </mat-select>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="detail-field">
        <mat-label>Tenure</mat-label>
        <mat-select [(ngModel)]="editableOpportunity.tenure">
          <mat-option *ngFor="let tenure of tenureOptions" [value]="tenure">
            {{tenure}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="detail-field">
        <mat-label>Location</mat-label>
        <mat-select [(ngModel)]="editableOpportunity.location">
          <mat-option *ngFor="let location of locations" [value]="location">
            {{location}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="detail-field">
        <mat-label>Loss Impact</mat-label>
        <mat-select [(ngModel)]="editableOpportunity.lossImpact">
          <mat-option value="Low">Low</mat-option>
          <mat-option value="Medium">Medium</mat-option>
          <mat-option value="High">High</mat-option>
        </mat-select>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="detail-field">
        <mat-label>Attrition Risk</mat-label>
        <mat-select [(ngModel)]="editableOpportunity.attritionRisk">
          <mat-option value="Low">Low</mat-option>
          <mat-option value="Medium">Medium</mat-option>
          <mat-option value="High">High</mat-option>
        </mat-select>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="detail-field">
        <mat-label>Attrition Response</mat-label>
        <mat-select [(ngModel)]="editableOpportunity.attritionResponse">
          <mat-option *ngFor="let response of attritionResponseOptions" [value]="response">
            {{response}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="detail-field">
        <mat-label>Rotation Level</mat-label>
        <mat-select [(ngModel)]="editableOpportunity.rotationLevel">
          <mat-option *ngFor="let level of rotationLevelOptions" [value]="level">
            {{level}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    
    <div class="toggle-group">
      <mat-slide-toggle [(ngModel)]="editableOpportunity.mentorAvailable" class="detail-toggle">
        <mat-icon>supervisor_account</mat-icon>
        Mentor Available
      </mat-slide-toggle>
      
      <mat-slide-toggle [(ngModel)]="editableOpportunity.remote" class="detail-toggle">
        <mat-icon>home</mat-icon>
        Remote OK
      </mat-slide-toggle>
      
      <mat-slide-toggle [(ngModel)]="editableOpportunity.dayZero" class="detail-toggle">
        <mat-icon>flag</mat-icon>
        Day Zero
      </mat-slide-toggle>
    </div>
  </div>


  <div class="skill-gaps" *ngIf="match.skillGaps.length > 0">
    <h3><mat-icon>trending_up</mat-icon> Skills to develop:</h3>
    <div class="chip-container">
      <mat-chip *ngFor="let skill of match.skillGaps" class="gap-chip">
        {{skill}}
      </mat-chip>
    </div>
  </div>

  <!-- Assignment Section -->
  <div class="assignment-section">
    <h3><mat-icon>assignment_ind</mat-icon> Employee Assignment</h3>
    
    <div *ngIf="match.opportunity.assignedEmployee" class="assigned-employee">
      <div class="employee-info">
        <mat-icon>person</mat-icon>
        <div class="employee-details">
          <span class="employee-name">{{match.opportunity.assignedEmployee.name}}</span>
          <span class="employee-role">{{match.opportunity.assignedEmployee.currentRole}} • {{match.opportunity.assignedEmployee.department}}</span>
          <span class="assignment-date">Assigned on {{formatDate(match.opportunity.assignmentDate || '')}}</span>
        </div>
      </div>
      <button mat-icon-button color="warn" (click)="removeAssignment()" class="remove-assignment">
        <mat-icon>person_remove</mat-icon>
      </button>
    </div>

    <div *ngIf="!match.opportunity.assignedEmployee" class="assignment-form">
      <mat-form-field appearance="outline" class="employee-select">
        <mat-label>Select Employee to Assign</mat-label>
        <mat-select [(value)]="selectedEmployeeId" (selectionChange)="onEmployeeSelected($event)">
          <mat-option *ngFor="let employee of availableEmployees" [value]="employee.id">
            <div class="employee-option">
              <span class="employee-name">{{employee.name}}</span>
              <span class="employee-role">{{employee.currentRole}} • {{employee.department}}</span>
            </div>
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <button mat-raised-button color="accent" 
              [disabled]="!selectedEmployeeId" 
              (click)="assignEmployee()" 
              class="assign-button">
        <mat-icon>person_add</mat-icon>
        Assign Employee
      </button>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions class="modal-actions" [class.edit-mode]="isEditMode">
  <div class="deadline-info" *ngIf="!isEditMode">
    <mat-icon>event</mat-icon>
    <span>Apply by: {{formatDate(match.opportunity.applicationDeadline)}}</span>
  </div>
  <div class="start-date-info" *ngIf="!isEditMode">
    <mat-icon>play_arrow</mat-icon>
    <span>Starts: {{formatDate(match.opportunity.startDate)}}</span>
  </div>
  
  <div class="date-fields" *ngIf="isEditMode">
    <mat-form-field appearance="outline" class="date-field">
      <mat-label>Application Deadline</mat-label>
      <input matInput [matDatepicker]="deadlinePicker" [(ngModel)]="editableOpportunity.applicationDeadline">
      <mat-datepicker-toggle matSuffix [for]="deadlinePicker"></mat-datepicker-toggle>
      <mat-datepicker #deadlinePicker></mat-datepicker>
    </mat-form-field>
    
    <mat-form-field appearance="outline" class="date-field">
      <mat-label>Start Date</mat-label>
      <input matInput [matDatepicker]="startPicker" [(ngModel)]="editableOpportunity.startDate">
      <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
      <mat-datepicker #startPicker></mat-datepicker>
    </mat-form-field>
  </div>
  
  <div class="action-buttons">
    <button mat-raised-button color="primary" (click)="onClose()">
      <mat-icon>close</mat-icon>
      Close
    </button>
  </div>
</mat-dialog-actions>
