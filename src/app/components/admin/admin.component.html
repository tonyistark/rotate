<div class="admin-container">
  <!-- Header Section -->
  <div class="admin-header">
    <div class="header-content">
      <div class="title-section">
        <mat-icon class="admin-icon">admin_panel_settings</mat-icon>
        <div class="title-text">
          <div class="title-with-help">
            <h1>Admin Dashboard</h1>
            <button mat-icon-button 
                    class="help-button"
                    (click)="toggleHelpPopup()"
                    matTooltip="Help">
              <mat-icon>help</mat-icon>
            </button>
          </div>
          <p>Upload and manage opportunities and employees data</p>
          <div class="header-actions">
            <button mat-raised-button color="accent" (click)="exportAllZip()">
              <mat-icon>archive</mat-icon>
              Export All (ZIP)
            </button>
          </div>
        </div>
      </div>
      
      <div class="stats-section">
        <div class="stat-card">
          <mat-icon>work</mat-icon>
          <div class="stat-info">
            <span class="stat-value">{{ currentOpportunities }}</span>
            <span class="stat-label">Opportunities</span>
          </div>
        </div>
        <div class="stat-card">
          <mat-icon>people</mat-icon>
          <div class="stat-info">
            <span class="stat-value">{{ currentEmployees }}</span>
            <span class="stat-label">Employees</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Upload Sections -->
  <div class="upload-sections">
    
    <!-- Opportunities Upload Section -->
    <mat-card class="upload-card">
      <mat-card-header>
        <div mat-card-avatar class="upload-avatar opportunities-avatar">
          <mat-icon>work</mat-icon>
        </div>
        <mat-card-title>Upload Opportunities</mat-card-title>
        <mat-card-subtitle>Import opportunities data from CSV file</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <!-- File Upload Section -->
        <div class="file-upload-section">
          <div class="upload-area" 
               [class.has-file]="opportunitiesFile"
               [class.uploading]="opportunitiesUploading"
               [class.drag-over]="opportunitiesDragOver"
               (dragover)="onOpportunitiesDragOver($event)"
               (dragleave)="onOpportunitiesDragLeave($event)"
               (drop)="onOpportunitiesDrop($event)">
            
            <input type="file" 
                   id="opportunities-file-input"
                   accept=".csv"
                   (change)="onOpportunitiesFileSelected($event)"
                   hidden>
            
            <div class="upload-content" *ngIf="!opportunitiesFile">
              <mat-icon class="upload-icon">cloud_upload</mat-icon>
              <h3>Drag & Drop CSV File</h3>
              <p>Drag your opportunities CSV file here or click to browse</p>
              <button mat-raised-button 
                      color="primary"
                      (click)="triggerOpportunitiesFileInput()">
                <mat-icon>folder_open</mat-icon>
                Browse Files
              </button>
            </div>
            
            <div class="file-selected" *ngIf="opportunitiesFile && !opportunitiesUploading">
              <mat-icon class="file-icon">description</mat-icon>
              <div class="file-info">
                <span class="file-name">{{ opportunitiesFile.name }}</span>
                <span class="file-size">{{ (opportunitiesFile.size / 1024).toFixed(1) }} KB</span>
              </div>
              <button mat-icon-button 
                      color="warn"
                      (click)="clearOpportunitiesFile()"
                      matTooltip="Remove file">
                <mat-icon>close</mat-icon>
              </button>
            </div>
            
            <div class="uploading-state" *ngIf="opportunitiesUploading">
              <mat-spinner diameter="40"></mat-spinner>
              <p>Uploading opportunities...</p>
            </div>
          </div>
        </div>

        <!-- Upload Result -->
        <div class="upload-result" *ngIf="opportunitiesResult">
          <mat-card class="result-card" 
                    [class.success]="opportunitiesResult.success"
                    [class.error]="!opportunitiesResult.success">
            <div class="result-content">
              <mat-icon class="result-icon">
                {{ opportunitiesResult.success ? 'check_circle' : 'error' }}
              </mat-icon>
              <div class="result-text">
                <span class="result-message">{{ opportunitiesResult.message }}</span>
                <span class="result-count" *ngIf="opportunitiesResult.count">
                  {{ opportunitiesResult.count }} records processed
                </span>
              </div>
            </div>
          </mat-card>
        </div>
      </mat-card-content>
      
      <mat-card-actions>
        <button mat-raised-button 
                color="primary"
                [disabled]="!opportunitiesFile || opportunitiesUploading"
                (click)="uploadOpportunities()">
          <mat-icon>upload</mat-icon>
          Upload Opportunities
        </button>
        
        <button mat-button 
                (click)="downloadOpportunitiesSample()">
          <mat-icon>download</mat-icon>
          Download Sample CSV
        </button>

        <button mat-stroked-button 
                color="accent"
                (click)="exportOpportunities()">
          <mat-icon>ios_share</mat-icon>
          Export Opportunities
        </button>
      </mat-card-actions>
    </mat-card>

    <!-- Employees Upload Section -->
    <mat-card class="upload-card">
      <mat-card-header>
        <div mat-card-avatar class="upload-avatar employees-avatar">
          <mat-icon>people</mat-icon>
        </div>
        <mat-card-title>Upload Employees</mat-card-title>
        <mat-card-subtitle>Import employee data from CSV file</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <!-- File Upload Section -->
        <div class="file-upload-section">
          <div class="upload-area" 
               [class.has-file]="employeesFile"
               [class.uploading]="employeesUploading"
               [class.drag-over]="employeesDragOver"
               (dragover)="onEmployeesDragOver($event)"
               (dragleave)="onEmployeesDragLeave($event)"
               (drop)="onEmployeesDrop($event)">
            
            <input type="file" 
                   id="employees-file-input"
                   accept=".csv"
                   (change)="onEmployeesFileSelected($event)"
                   hidden>
            
            <div class="upload-content" *ngIf="!employeesFile">
              <mat-icon class="upload-icon">cloud_upload</mat-icon>
              <h3>Drag & Drop CSV File</h3>
              <p>Drag your employees CSV file here or click to browse</p>
              <button mat-raised-button 
                      color="primary"
                      (click)="triggerEmployeesFileInput()">
                <mat-icon>folder_open</mat-icon>
                Browse Files
              </button>
            </div>
            
            <div class="file-selected" *ngIf="employeesFile && !employeesUploading">
              <mat-icon class="file-icon">description</mat-icon>
              <div class="file-info">
                <span class="file-name">{{ employeesFile.name }}</span>
                <span class="file-size">{{ (employeesFile.size / 1024).toFixed(1) }} KB</span>
              </div>
              <button mat-icon-button 
                      color="warn"
                      (click)="clearEmployeesFile()"
                      matTooltip="Remove file">
                <mat-icon>close</mat-icon>
              </button>
            </div>
            
            <div class="uploading-state" *ngIf="employeesUploading">
              <mat-spinner diameter="40"></mat-spinner>
              <p>Uploading employees...</p>
            </div>
          </div>
        </div>

        <!-- Upload Result -->
        <div class="upload-result" *ngIf="employeesResult">
          <mat-card class="result-card" 
                    [class.success]="employeesResult.success"
                    [class.error]="!employeesResult.success">
            <div class="result-content">
              <mat-icon class="result-icon">
                {{ employeesResult.success ? 'check_circle' : 'error' }}
              </mat-icon>
              <div class="result-text">
                <span class="result-message">{{ employeesResult.message }}</span>
                <span class="result-count" *ngIf="employeesResult.count">
                  {{ employeesResult.count }} records processed
                </span>
              </div>
            </div>
          </mat-card>
        </div>
      </mat-card-content>
      
      <mat-card-actions>
        <button mat-raised-button 
                color="primary"
                [disabled]="!employeesFile || employeesUploading"
                (click)="uploadEmployees()">
          <mat-icon>upload</mat-icon>
          Upload Employees
        </button>
        
        <button mat-button 
                (click)="downloadEmployeesSample()">
          <mat-icon>download</mat-icon>
          Download Sample CSV
        </button>

        <button mat-stroked-button 
                color="accent"
                (click)="exportEmployees()">
          <mat-icon>ios_share</mat-icon>
          Export Employees
        </button>
      </mat-card-actions>
    </mat-card>

    <!-- Matches Export/Import Section -->
    <mat-card class="upload-card">
      <mat-card-header>
        <div mat-card-avatar class="upload-avatar opportunities-avatar">
          <mat-icon>link</mat-icon>
        </div>
        <mat-card-title>Current Matches</mat-card-title>
        <mat-card-subtitle>Export current/selected opportunity matches or import previously saved matches</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="file-upload-section">
          <div class="upload-area" 
               [class.has-file]="matchesFile"
               [class.uploading]="matchesUploading">
            <input type="file" 
                   id="matches-file-input"
                   accept=".csv"
                   (change)="onMatchesFileSelected($event)"
                   hidden>

            <div class="upload-content" *ngIf="!matchesFile">
              <mat-icon class="upload-icon">cloud_upload</mat-icon>
              <h3>Import Current Matches CSV</h3>
              <p>Choose a previously exported current matches CSV to restore</p>
              <button mat-raised-button 
                      color="primary"
                      (click)="triggerMatchesFileInput()">
                <mat-icon>folder_open</mat-icon>
                Browse Files
              </button>
            </div>

            <div class="file-selected" *ngIf="matchesFile && !matchesUploading">
              <mat-icon class="file-icon">description</mat-icon>
              <div class="file-info">
                <span class="file-name">{{ matchesFile.name }}</span>
                <span class="file-size">{{ (matchesFile.size / 1024).toFixed(1) }} KB</span>
              </div>
              <button mat-icon-button 
                      color="warn"
                      (click)="clearMatchesFile()"
                      matTooltip="Remove file">
                <mat-icon>close</mat-icon>
              </button>
            </div>

            <div class="uploading-state" *ngIf="matchesUploading">
              <mat-spinner diameter="40"></mat-spinner>
              <p>Uploading matches...</p>
            </div>
          </div>
        </div>

        <!-- Upload Result -->
        <div class="upload-result" *ngIf="matchesResult">
          <mat-card class="result-card" 
                    [class.success]="matchesResult.success"
                    [class.error]="!matchesResult.success">
            <div class="result-content">
              <mat-icon class="result-icon">
                {{ matchesResult.success ? 'check_circle' : 'error' }}
              </mat-icon>
              <div class="result-text">
                <span class="result-message">{{ matchesResult.message }}</span>
                <span class="result-count" *ngIf="matchesResult.count">
                  {{ matchesResult.count }} records processed
                </span>
              </div>
            </div>
          </mat-card>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-raised-button 
                color="primary"
                [disabled]="!matchesFile || matchesUploading"
                (click)="uploadMatches()">
          <mat-icon>upload</mat-icon>
          Import Current Matches
        </button>

        <button mat-raised-button 
                color="primary"
                (click)="saveCurrentMatches()">
          <mat-icon>save</mat-icon>
          Save Current Matches
        </button>

        <button mat-stroked-button 
                color="accent"
                (click)="exportMatches()">
          <mat-icon>download</mat-icon>
          Export Current Matches
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Help Popup - Floating Overlay -->
  <div class="help-overlay" *ngIf="showHelpPopup" [@slideIn] (click)="toggleHelpPopup()">
    <mat-card class="popup-card" (click)="$event.stopPropagation()">
      <mat-card-header>
        <mat-card-title>CSV Format Guidelines</mat-card-title>
        <button mat-icon-button (click)="toggleHelpPopup()" class="close-button">
          <mat-icon>close</mat-icon>
        </button>
      </mat-card-header>
      <mat-card-content>
        <div class="help-content">
          <h4>🔹 Opportunities CSV</h4>
          <p><strong>Required:</strong> title, department</p>
          <p><strong>Optional:</strong> id, location, description, requiredSkills, duration, startDate, priority, status, remote, experienceLevel, workType</p>
          <p><strong>Skills:</strong> separated by semicolons (;)</p>
          
          <h4>👥 Employees CSV</h4>
          <p><strong>Required:</strong> name, email</p>
          <p><strong>Optional:</strong> id, department, role, location, skills, experience, availability, performanceRating, remote, workType</p>
          <p><strong>Skills:</strong> separated by semicolons (;)</p>
          
          <h4>⚙️ General Rules</h4>
          <ul>
            <li>First row must contain column headers</li>
            <li>Use double quotes for text containing commas</li>
            <li>Boolean values: true/false, 1/0, or yes/no</li>
            <li>Download sample files to see exact format</li>
          </ul>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

</div>
